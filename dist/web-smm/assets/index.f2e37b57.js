var n=Object.defineProperty;var h=(s,a,e)=>a in s?n(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var t=(s,a,e)=>(h(s,typeof a!="symbol"?a+"":a,e),e);import{r}from"./index.e51afe9d.js";class E{constructor(){t(this,"PageKey","");t(this,"formRef",r());t(this,"rules",r({}));t(this,"dataPermits",r({}));t(this,"setRules",a=>{this.rules.value={},Object.entries(a).forEach(([e,i])=>{if(i.powerCode==="required"){const[u,...d]=e.split(".");d.length||(this.rules.value[e]={type:i.dbType,required:!0,trigger:["blur","input"],message:`${i.nameCh}\u8BE5\u5C5E\u6027\u4E3A\u5FC5\u586B`})}else this.dataPermits.value[e]=i.powerCode})});t(this,"validate",async()=>{var e;let a=[];return await((e=this.formRef.value)==null?void 0:e.validate().then(()=>{a=[]}).catch(i=>{a=i.map(u=>u[0].message)})),a});this.init()}init(){this.PageKey=window.location.hash.substring(1),window.parent.postMessage({cmd:"INIT_COMPLETE",key:this.PageKey},"*"),window.addEventListener("message",a=>{switch(a.data.cmd){case"SET_VALUE":this.setValue(a.data.value);break;case"SET_RULES":this.setRules(a.data.value);break;case"GET_VALUE":this.getValue().then(e=>{window.parent.postMessage({cmd:"GET_VALUE",value:e,key:this.PageKey},"*")});break;case"GET_SCHEMA":this.getSchema().then(e=>{window.parent.postMessage({cmd:"GET_SCHEMA",value:e,key:this.PageKey},"*")});break;case"GET_VALIDATE":this.validate?this.validate().then(e=>{window.parent.postMessage({cmd:"GET_VALIDATE",value:e,key:this.PageKey},"*")}):window.parent.postMessage({cmd:"GET_VALIDATE",value:[],key:this.PageKey},"*");break}})}}export{E as A};
