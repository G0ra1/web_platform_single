import{bK as k,aH as q,eM as O,C,a_ as V,a as x,b as P,e as K,f as S,am as z,u as Y,_ as U,aV as H}from"./index.0e7eb3bd.js";import{A as W}from"./aes.da6c9164.js";import{d as R,r as I,a as w,o as $,c as L,w as _,h as y,b,ac as M,ab as N,f as j,p as X,_ as G,$ as J}from"./runtime-dom.esm-bundler.bf4f36cb.js";import{N as Q}from"./FormItemGridItem.5c201774.js";const Z=[{appName:"\u5E94\u7528\u8D44\u6E90\u7BA1\u7406",appCode:"app",appType:"system",menus:[{label:"\u4E1A\u52A1\u5165\u53E3",key:"bizmenu-manage",url:"/web-main/pages/bizmenu-manage.html",type:0,sonMenus:[{label:"\u83DC\u5355\u7BA1\u7406",key:"menu-manage",url:"/web-main/pages/menu-manage.html"}]},{label:"\u5E94\u7528\u7BA1\u7406",key:"app-manage",url:"/web-main/pages/app-manage.html",type:0,sonMenus:[{label:"\u9875\u9762\u7BA1\u7406",key:"page-manage",url:"/web-main/pages/page-manage.html"},{label:"\u529F\u80FD\u7BA1\u7406",key:"function-manage",url:"/web-main/pages/function-manage.html"}]},{label:"OpenApi\u7BA1\u7406",key:"openapi-manage",type:1,url:"/web-main/pages/openapi-manage.html"},{label:"\u89D2\u8272\u6743\u9650\u7BA1\u7406",key:"row-manage",type:1,url:"/web-main/pages/row-manage.html"},{label:"\u6570\u636E\u6E90\u7BA1\u7406",key:"dbds-manage",type:1,url:"/web-old/html/model/dbds.html"},{label:"\u6570\u636E\u5EFA\u6A21",key:"model-manage",type:1,url:"/web-main/pages/model-manage.html"},{label:"\u4E1A\u52A1\u6743\u9650",key:"businessResource-manage",type:1,url:"/web-main/pages/businessResource-manage.html"},{label:"\u5B9A\u65F6\u4EFB\u52A1\u7BA1\u7406",key:"task-job",type:1,url:"/web-main/pages/task-job.html"},{label:"\u5B9A\u65F6\u4EFB\u52A1\u65E5\u5FD7",key:"task-log",type:1,url:"/web-main/pages/task-log.html"}],pages:{"app-manage":"/web-main/pages/app-manage.html","bizmenu-manage":"/web-main/pages/bizmenu-manage.html","menu-manage":"/web-main/pages/menu-manage.html","page-manage":"/web-main/pages/page-manage.html","function-manage":"/web-main/pages/function-manage.html","openapi-manage":"/web-main/pages/openapi-manage.html","row-manage":"/web-main/pages/row-manage.html","dbds-manage":"/web-old/html/model/dbds.html","model-manage":"/web-main/pages/model-manage.html","businessResource-manage":"/web-main/pages/businessResource-manage.html","task-job":"/web-main/pages/task-job.html","task-log":"/web-main/pages/task-log.html"},formListUrl:{"app-manage":"/main/mdmApp/page","bizmenu-manage":"/main/mdmBizMenu/page"}},{appName:"\u4E3B\u6570\u636E\u7BA1\u7406",appCode:"mdm",appType:"system",menus:[{label:"\u7EC4\u7EC7\u7BA1\u7406",key:"organization-manage",type:1,url:"/web-old/html/mdm/organization-manage.html"},{label:"\u7528\u6237\u7BA1\u7406",key:"emp-manage",type:1,url:"/web-old/html/mdm/emp-manage.html"}],pages:{"organization-manage":"/web-old/html/mdm/organization-manage.html","emp-manage":"/web-old/html/mdm/emp-manage.html"}},{appName:"\u6D41\u7A0B\u7BA1\u7406",appCode:"wf",appType:"system",menus:[{label:"\u6D41\u7A0B\u5206\u7C7B",key:"procdeftype",type:1,url:"/web-wf/pages/procdeftype.html"},{label:"\u6D41\u7A0B\u5B9A\u4E49",key:"procdef",type:1,url:"/web-wf/pages/procdef.html"},{label:"\u4E8B\u4EF6\u7EF4\u62A4",key:"event",type:1,url:"/web-wf/pages/event.html"},{label:"\u8868\u8FBE\u5F0F\u7EF4\u62A4",key:"expre",type:1,url:"/web-wf/pages/expre.html"}],pages:{procdeftype:"/web-wf/pages/procdeftype.html",procdef:"/web-wf/pages/procdef.html",event:"/web-wf/pages/event.html",expre:"/web-wf/pages/expre.html"}}];async function ee(t){k.clear();const u=new FormData;u.append("username",t.username),u.append("password",W.encrypt(t.password));const s=await new q("/sys/login","post",u).send().then(async l=>l).catch(l=>l);if(s.constructor===O.exports.AxiosError)throw s;C.remove("token"),C.remove("tokenType"),C.set("token",s.access_token),C.set("tokenType",s.token_type);const{resources:i,portalInfo:m,...f}=s.loginUser;await k.set("userInfo",f);const r={},a=(i||[]).filter(l=>l.bizMenuCode!=="incloud-old").map(l=>{const g=[],v=[],A={},E={};l.mdmMenuVos.forEach(e=>{e.level===1?(g.push({id:e.id,key:e.menuCode,label:e.menuName,type:e.menuType}),e.menuType===0&&(E[e.menuCode]=e.formListUrl)):e.level===2&&e.menuType!==2?v.push({id:e.id,key:e.menuCode,label:e.menuName,parentId:e.parentId}):e.menuType===2&&(r[e.parentId]||(r[e.parentId]={}),r[e.parentId][e.buttonCode]=e),e.formTargetUrl&&(A[e.menuCode]=V.addParamtoUrl(e.formTargetUrl,`menuId=${e.id}`))});const B=l.mdmMenuVos.filter(e=>e.level>1&&(e.menuType===1||e.menuType===3));return g.forEach(e=>{if(e.type===0)e.sonMenus=v.filter(n=>n.parentId===n.id);else if(e.type===3){const n={[`${e.id}`]:{...e,children:[]}};B.forEach(o=>{if(!n[o.id]){const c={id:o.id,label:o.menuName,key:o.menuCode,type:o.menuType};o.menuType===3&&(c.children=[]),n[o.id]=c}if(o.parentId===e.id)n[e.id].children.push(n[o.id]);else if(n[o.parentId])n[o.parentId].children.push(n[o.id]);else{const c=g.find(h=>h.id===o.parentId);n[o.parentId]={id:c.id,label:c.menuName,key:c.menuCode,type:c.menuType,children:[n[o.id]]}}}),e.sonMenus=n[e.id].children}}),{appName:l.bizMenuName,appCode:l.bizMenuCode,appType:"service",icon:l.bizMenuIcon,menus:g,pages:A,formListUrl:E}});await k.set("bizMenuInfo",[...a,...Z]);const p=[],d={};(m||[]).forEach(l=>{p.push({label:l.portalName,key:l.id}),d[l.id]=`/web-old/html/portal/template-render.html?portalid=${l.id}#/index`}),await k.set("portalInfo",{menus:p,pages:d}),await k.set("cpts",r)}const ae=R({components:{NForm:x,NFormItem:P,NInput:K,NButton:S,NSpin:z},emits:["callback"],setup(t,u){const s=I(null),i=I(!1),m=Y(),f=I({username:"",password:""});return{loading:i,formRef:s,model:f,rules:{},handle(){i.value=!0,ee(f.value).then(a=>{window.location.href="/web-main/pages/layout2.html"}).catch(a=>{console.error(a),m.error(a.message)}).finally(()=>{i.value=!1})},handleValidateButtonClick(a){var p;a.preventDefault(),(p=s.value)==null||p.validate(d=>{d?(console.log(d),m.error("\u9A8C\u8BC1\u5931\u8D25")):m.success("\u9A8C\u8BC1\u6210\u529F")})}}}});const ne={class:"login-card"},te=y("div",{class:"header"}," \u767B\u5F55\u7CFB\u7EDF ",-1),oe={class:"content"},se={class:"footer"};function le(t,u,s,i,m,f){const r=w("n-input"),a=w("n-form-item"),p=w("n-form"),d=w("n-button"),l=w("n-spin");return $(),L(l,{class:"",show:t.loading},{default:_(()=>[y("div",ne,[te,y("div",oe,[b(p,{ref:"formRef",model:t.model,rules:t.rules,"label-width":"100","label-placement":"top"},{default:_(()=>[b(a,{path:"username",label:"\u7528\u6237\u540D"},{default:_(()=>[b(r,{placeholder:"",value:t.model.username,"onUpdate:value":u[0]||(u[0]=g=>t.model.username=g),onKeydown:u[1]||(u[1]=M(N(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),b(a,{path:"password",label:"\u5BC6\u7801"},{default:_(()=>[b(r,{placeholder:"",value:t.model.password,"onUpdate:value":u[2]||(u[2]=g=>t.model.password=g),type:"password",onKeydown:u[3]||(u[3]=M(N(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),y("div",se,[b(d,{class:"login-btn",onClick:t.handle},{default:_(()=>[j(" \u767B\u5F55 ")]),_:1},8,["onClick"])])])]),_:1},8,["show"])}const ue=U(ae,[["render",le]]),me=function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(){var t={NUM_PARTICLES:80,DISTANCE_T:100,RADIUS:5,OPACITY:.5,SPEED_X:3,SPEED_Y:.5,AMPLITUDE:10},u=["#3FB8AF","#FF3D7F","#EBE54D"],s={},i=[],m=Math.random,f=Math.sqrt,r=Math.PI,a,p,d;function l(){this.x=m()*s.right,this.y=m()*s.bottom,this.xspeed=m()*t.SPEED_X,this.yspeed=m()*t.SPEED_Y,this.radius=t.RADIUS,this.colour=u[~~(m()*u.length)]}var g=function(){window.addEventListener("resize",v,!1)},v=function(){p=window.innerWidth,d=window.innerHeight,a.canvas.width=p,a.canvas.height=d,s.top=100,s.right=p-100,s.bottom=d-100,s.left=100},A=function(){B(),requestAnimFrame(A)},E=function(n){n.x+=n.xspeed,n.y+=n.yspeed,n.x>s.right&&(n.x=s.right,n.xspeed*=-1),n.x<s.left&&(n.x=s.left,n.xspeed*=-1),n.y>s.bottom&&(n.y=s.bottom,n.yspeed*=-1),n.y<s.top&&(n.y=s.top,n.yspeed*=-1)},B=function(){a.beginPath(),a.globalCompositeOperation="source-over",a.rect(0,0,p,d),a.fillStyle="#0208ac",a.fill(),a.closePath(),a.globalCompositeOperation="lighter";for(var n=0;n<i.length;n+=1){var o=i[n];a.beginPath(),a.globalAlpha=t.OPACITY,a.fillStyle=o.colour,a.arc(o.x,o.y,o.radius,r*2,!1),a.fill(),a.closePath();for(var c=0;c<i.length;c+=1){var h=i[c],F=h.y-o.y,T=h.x-o.x,D=f(T*T+F*F);D<t.DISTANCE_T&&(a.beginPath(),a.globalAlpha=(t.DISTANCE_T-D)/(t.DISTANCE_T-0),a.lineWidth=1,a.moveTo(o.x,o.y),a.bezierCurveTo(o.x,o.y-m()*t.AMPLITUDE,h.x,h.y+m()*t.AMPLITUDE,h.x,h.y),a.strokeStyle=o.colour,a.lineCap="round",a.stroke(),a.closePath())}E(o)}},e=function(){a=document.getElementsByTagName("canvas")[0].getContext("2d"),g(),v();for(var n=0;n<t.NUM_PARTICLES;n+=1)i.push(new l);A()};window.onload=e,e()}()},ie=R({components:{NForm:x,NFormItem:P,NFormItemGi:Q,NButton:S,LoginForm:ue,NMessageProvider:H,NSpin:z},setup(){return I(!1),X().then(()=>{me()}),{callback(t){},login(){}}}});const re=t=>(G("data-v-c8210aba"),t=t(),J(),t),pe={class:"warpper"},de=re(()=>y("div",{style:{position:"absolute",left:"0",right:"0",top:"0",width:"100%",height:"100%",overflow:"hidden",background:"#007aff"}},[y("canvas",{class:"canvas",width:"1920",height:"970"})],-1));function ce(t,u,s,i,m,f){const r=w("LoginForm"),a=w("n-message-provider");return $(),L(a,null,{default:_(()=>[y("div",pe,[de,b(r,{onCallback:t.callback},null,8,["onCallback"])])]),_:1})}const we=U(ie,[["render",ce],["__scopeId","data-v-c8210aba"]]);export{we as default};
