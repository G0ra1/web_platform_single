import{bK as E,aH as L,C,a as P,b as M,e as O,f as S,am as $,u as V,_ as U,aV as K}from"./index.0e7eb3bd.js";import{A as Y}from"./aes.da6c9164.js";import{d as R,r as T,a as _,o as z,c as q,w as k,h as v,b as y,ac as N,ab as x,f as H,p as W,_ as j,$ as X}from"./runtime-dom.esm-bundler.bf4f36cb.js";import{N as G}from"./FormItemGridItem.5c201774.js";const J=[{appName:"\u5E94\u7528\u8D44\u6E90\u7BA1\u7406",appCode:"app",appType:"system",menus:[{label:"\u5E94\u7528\u7BA1\u7406",key:"app-manage",url:"/web-main/pages/app-manage.html"},{label:"\u83DC\u5355\u7BA1\u7406",key:"menu-manage",url:"/web-main/pages/menu-manage.html"},{label:"\u9875\u9762\u7BA1\u7406",key:"page-manage",url:"/web-main/pages/page-manage.html"},{label:"\u529F\u80FD\u7BA1\u7406",key:"function-manage",url:"/web-main/pages/function-manage.html"},{label:"OpenApi\u7BA1\u7406",key:"openapi-manage",url:"/web-main/pages/openapi-manage.html"},{label:"\u89D2\u8272\u6743\u9650\u7BA1\u7406",key:"row-manage",url:"/web-main/pages/row-manage.html"},{label:"\u6570\u636E\u6E90\u7BA1\u7406",key:"dbds-manage",url:"/web-old/html/model/dbds.html"},{label:"\u6570\u636E\u5EFA\u6A21",key:"model-manage",url:"/web-main/pages/model-manage.html"},{label:"\u4E1A\u52A1\u6743\u9650",key:"businessResource-manage",url:"/web-main/pages/businessResource-manage.html"},{label:"\u5B9A\u65F6\u4EFB\u52A1\u7BA1\u7406",key:"task-job",url:"/web-main/pages/task-job.html"},{label:"\u5B9A\u65F6\u4EFB\u52A1\u65E5\u5FD7",key:"task-log",url:"/web-main/pages/task-log.html"}],pages:{"app-manage":"/web-main/pages/app-manage.html","menu-manage":"/web-main/pages/menu-manage.html","page-manage":"/web-main/pages/page-manage.html","function-manage":"/web-main/pages/function-manage.html","openapi-manage":"/web-main/pages/openapi-manage.html","row-manage":"/web-main/pages/row-manage.html","dbds-manage":"/web-old/html/model/dbds.html","model-manage":"/web-main/pages/model-manage.html","businessResource-manage":"/web-main/pages/businessResource-manage.html","task-job":"/web-main/pages/task-job.html","task-log":"/web-main/pages/task-log.html"}},{appName:"\u4E3B\u6570\u636E\u7BA1\u7406",appCode:"mdm",appType:"system",menus:[{label:"\u7EC4\u7EC7\u7BA1\u7406",key:"organization-manage",url:"/web-old/html/mdm/organization-manage.html"},{label:"\u7528\u6237\u7BA1\u7406",key:"emp-manage",url:"/web-old/html/mdm/emp-manage.html"}],pages:{"organization-manage":"/web-old/html/mdm/organization-manage.html","emp-manage":"/web-old/html/mdm/emp-manage.html"}},{appName:"\u6D41\u7A0B\u7BA1\u7406",appCode:"wf",appType:"system",menus:[{label:"\u6D41\u7A0B\u5206\u7C7B",key:"procdeftype",url:"/web-wf/pages/procdeftype.html"},{label:"\u6D41\u7A0B\u5B9A\u4E49",key:"procdef",url:"/web-wf/pages/procdef.html"},{label:"\u4E8B\u4EF6\u7EF4\u62A4",key:"event",url:"/web-wf/pages/event.html"},{label:"\u8868\u8FBE\u5F0F\u7EF4\u62A4",key:"expre",url:"/web-wf/pages/expre.html"}],pages:{procdeftype:"/web-wf/pages/procdeftype.html",procdef:"/web-wf/pages/procdef.html",event:"/web-wf/pages/event.html",expre:"/web-wf/pages/expre.html"}}];async function Q(n){E.clear();const s=new FormData;s.append("username",n.username),s.append("password",Y.encrypt(n.password));const t=await new L("/sys/login","post",s).send().then(async l=>l);C.remove("token"),C.remove("tokenType"),C.set("token",t.access_token),C.set("tokenType",t.token_type);const{resources:m,portalInfo:u,...h}=t.loginUser;await E.set("userInfo",h);const p={},a=(m||[]).filter(l=>l.bizMenuCode!=="incloud-old").map(l=>{const f=[],b={};l.mdmMenuVos.forEach(e=>{if(e.menuType===0||e.menuType===3)f.push(e);else if(e.menuType===1){if(e.formTargetUrl){const r=e.formTargetUrl.indexOf("?"),w=e.formTargetUrl.length;e.formTargetUrl[e.formTargetUrl.length-1],r>=0&&r!==w-1?b[e.menuCode]=`${e.formTargetUrl}&menuId=${e.id}`:r>=0&&r===w-1?b[e.menuCode]=`${e.formTargetUrl}menuId=${e.id}`:b[e.menuCode]=`${e.formTargetUrl}?menuId=${e.id}`}f.push(e)}else e.menuType===2&&(p[e.parentId]||(p[e.parentId]={}),p[e.parentId][e.buttonCode]=e)});const i={0:{id:"root",label:"root",key:"root",children:[]}};return f.forEach(e=>{if(!i[e.id]){const r={id:e.id,label:e.menuName,key:e.menuCode,type:e.menuType};(e.menuType===0||e.menuType===3)&&(r.children=[]),i[e.id]=r}if(e.parentId==="0")i[0].children.push(i[e.id]);else if(i[e.parentId])i[e.parentId].children.push(i[e.id]);else{const r=f.find(w=>w.id===e.parentId);i[e.parentId]={id:r.id,label:r.menuName,key:r.menuCode,type:r.menuType,children:[i[e.id]]}}}),{appName:l.bizMenuName,appCode:l.bizMenuCode,appType:"service",icon:l.bizMenuIcon,menus:i[0].children,pages:b}});await E.set("bizMenuInfo",[...a,...J]);const d=[],c={};(u||[]).forEach(l=>{d.push({label:l.portalName,key:l.id}),c[l.id]=`/web-old/html/portal/template-render.html?portalid=${l.id}#/index`}),await E.set("portalInfo",{menus:d,pages:c}),await E.set("cpts",p)}const Z=R({components:{NForm:P,NFormItem:M,NInput:O,NButton:S,NSpin:$},emits:["callback"],setup(n,s){const t=T(null),m=T(!1),u=V(),h=T({username:"",password:""});return{loading:m,formRef:t,model:h,rules:{},handle(){m.value=!0,Q(h.value).then(a=>{window.location.href="/web-main/pages/layout.html#portalframe"}).catch(a=>{console.error(a)}).finally(()=>{m.value=!1})},handleValidateButtonClick(a){var d;a.preventDefault(),(d=t.value)==null||d.validate(c=>{c?(console.log(c),u.error("\u9A8C\u8BC1\u5931\u8D25")):u.success("\u9A8C\u8BC1\u6210\u529F")})}}}});const ee={class:"login-card"},ae=v("div",{class:"header"}," \u767B\u5F55\u7CFB\u7EDF ",-1),ne={class:"content"},te={class:"footer"};function oe(n,s,t,m,u,h){const p=_("n-input"),a=_("n-form-item"),d=_("n-form"),c=_("n-button"),l=_("n-spin");return z(),q(l,{class:"",show:n.loading},{default:k(()=>[v("div",ee,[ae,v("div",ne,[y(d,{ref:"formRef",model:n.model,rules:n.rules,"label-width":"100","label-placement":"top"},{default:k(()=>[y(a,{path:"username",label:"\u7528\u6237\u540D"},{default:k(()=>[y(p,{placeholder:"",value:n.model.username,"onUpdate:value":s[0]||(s[0]=f=>n.model.username=f),onKeydown:s[1]||(s[1]=N(x(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),y(a,{path:"password",label:"\u5BC6\u7801"},{default:k(()=>[y(p,{placeholder:"",value:n.model.password,"onUpdate:value":s[2]||(s[2]=f=>n.model.password=f),type:"password",onKeydown:s[3]||(s[3]=N(x(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),v("div",te,[y(c,{class:"login-btn",onClick:n.handle},{default:k(()=>[H(" \u767B\u5F55 ")]),_:1},8,["onClick"])])])]),_:1},8,["show"])}const se=U(Z,[["render",oe]]),le=function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}(),function(){var n={NUM_PARTICLES:80,DISTANCE_T:100,RADIUS:5,OPACITY:.5,SPEED_X:3,SPEED_Y:.5,AMPLITUDE:10},s=["#3FB8AF","#FF3D7F","#EBE54D"],t={},m=[],u=Math.random,h=Math.sqrt,p=Math.PI,a,d,c;function l(){this.x=u()*t.right,this.y=u()*t.bottom,this.xspeed=u()*n.SPEED_X,this.yspeed=u()*n.SPEED_Y,this.radius=n.RADIUS,this.colour=s[~~(u()*s.length)]}var f=function(){window.addEventListener("resize",b,!1)},b=function(){d=window.innerWidth,c=window.innerHeight,a.canvas.width=d,a.canvas.height=c,t.top=100,t.right=d-100,t.bottom=c-100,t.left=100},i=function(){r(),requestAnimFrame(i)},e=function(o){o.x+=o.xspeed,o.y+=o.yspeed,o.x>t.right&&(o.x=t.right,o.xspeed*=-1),o.x<t.left&&(o.x=t.left,o.xspeed*=-1),o.y>t.bottom&&(o.y=t.bottom,o.yspeed*=-1),o.y<t.top&&(o.y=t.top,o.yspeed*=-1)},r=function(){a.beginPath(),a.globalCompositeOperation="source-over",a.rect(0,0,d,c),a.fillStyle="#0208ac",a.fill(),a.closePath(),a.globalCompositeOperation="lighter";for(var o=0;o<m.length;o+=1){var g=m[o];a.beginPath(),a.globalAlpha=n.OPACITY,a.fillStyle=g.colour,a.arc(g.x,g.y,g.radius,p*2,!1),a.fill(),a.closePath();for(var I=0;I<m.length;I+=1){var A=m[I],B=A.y-g.y,F=A.x-g.x,D=h(F*F+B*B);D<n.DISTANCE_T&&(a.beginPath(),a.globalAlpha=(n.DISTANCE_T-D)/(n.DISTANCE_T-0),a.lineWidth=1,a.moveTo(g.x,g.y),a.bezierCurveTo(g.x,g.y-u()*n.AMPLITUDE,A.x,A.y+u()*n.AMPLITUDE,A.x,A.y),a.strokeStyle=g.colour,a.lineCap="round",a.stroke(),a.closePath())}e(g)}},w=function(){a=document.getElementsByTagName("canvas")[0].getContext("2d"),f(),b();for(var o=0;o<n.NUM_PARTICLES;o+=1)m.push(new l);i()};window.onload=w,w()}()},ue=R({components:{NForm:P,NFormItem:M,NFormItemGi:G,NButton:S,LoginForm:se,NMessageProvider:K,NSpin:$},setup(){return T(!1),W().then(()=>{le()}),{callback(n){},login(){}}}});const re=n=>(j("data-v-5c77990f"),n=n(),X(),n),me={class:"warpper"},ie=re(()=>v("div",{style:{position:"absolute",left:"0",right:"0",top:"0",width:"100%",height:"100%",overflow:"hidden",background:"#007aff"}},[v("canvas",{class:"canvas",width:"1920",height:"970"})],-1));function pe(n,s,t,m,u,h){const p=_("LoginForm"),a=_("n-message-provider");return z(),q(a,null,{default:k(()=>[v("div",me,[ie,y(p,{onCallback:n.callback},null,8,["onCallback"])])]),_:1})}const he=U(ue,[["render",pe],["__scopeId","data-v-5c77990f"]]);export{he as default};
